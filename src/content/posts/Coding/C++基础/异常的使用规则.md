---
title: 异常的使用规则
published: 2025-09-02T15:27:21Z
description: 'C++中，异常的使用规则和日志输出规范'
image: ''
tags: [C++, Exception, Log, Best Practices]
category: 'C++'
draft: false
---

# 异常的使用规则

## 前言，个人使用的基本情况

在编写一些需要调用第三方库的代码时，例如：MySQL查询，Redis查询，IO数据读取时，我往往会直接使用`try{...}catch{std::exception& e}`来捕获异常，并进行相应的处理。

例如：
```cpp
try{
    std::string query = "SELECT * FROM users";
    // 执行查询
    std::unique_ptr<sql::PreparedStatement> pstmt(con->prepareStatement(query));
    pstmt->executeQuery();
}
catch(const std::exception& e){
    std::cerr << "Error: " << e.what() << std::endl;
}
```

## 反思，应当如何做

我只知道这样可以捕获到异常，并且能够正确地在控制台中输出这些消息。但是在实际开发中，我们还需要考虑如何更好地记录这些异常信息，以便后续的排查和分析。

而且，对自己编写的代码出现意料之外的情况时，也要主动地抛出异常，而不是简单地返回错误码。这样可以让调用者更清晰地知道哪里出了问题，并且可以通过异常链来追踪问题的根源。

## 合理的实践

异常传递过程：
1. 函数内部抛出异常
2. 调用者没有捕获，继续向上传递
3. 直到main函数，仍然没有处理，程序终止
![异常的使用规则-2025-09-02-15-36-03](https://cdn.jsdelivr.net/gh/chrisnake11/picgo@main/blog/异常的使用规则-2025-09-02-15-36-03.png)

# 参考

[Hacking C++](https://hackingcpp.com/cpp/lang/exceptions.html)