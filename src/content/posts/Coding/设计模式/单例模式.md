---
title: 单例模式
published: 2025-09-05T12:00:12Z
description: ''
image: ''
tags: []
category: ''
draft: false
---

# 单例模式

单例模式（Singleton Pattern）是一种设计模式，旨在确保一个类只有一个实例，并提供一个全局访问点来获取该实例。

单例模式常用于需要全局控制的资源管理，例如配置管理、日志记录、线程池等。

## 单例模板类

在代码中，`Singleton` 类模板定义了一个静态成员函数 `getInstance`，用于获取单例实例。该函数使用 `std::call_once` 确保实例只被创建一次。


```cpp
template <typename T>
class Singleton{
public:
    static std::shared_ptr<T> getInstance();
protected:
    static std::shared_ptr<T> _instance;
    Singleton() = default;
    ~Singleton() = default;
    Singleton(const Singleton&) = delete;
    Singleton& operator=(const Singleton&) = delete;
    Singleton(Singleton&&) = delete;
    Singleton& operator=(Singleton&&) = delete;
private:
    std::call_once_flag flag_;
};

template <typename T>
std::shared_ptr<T> Singleton<T>::_instance = std::shared_ptr<T>();

template <typename T>
std::once_flag Singleton<T>::_flag;
```


+ 将Singleton的静态函数声明和定义分开，避免在Windows下DLL重复定义的问题。

```cpp
template <typename T>
std::shared_ptr<T> Singleton<T>::getInstance() {
    std::call_once(flag_, []() {
        _instance.reset(new T());
    });
    return _instance;
}
```